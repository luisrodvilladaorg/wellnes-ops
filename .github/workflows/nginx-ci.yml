name: Nginx CI

# üîπ Se ejecuta cuando hay cambios en main o PR
on:
    push:
        branches: [feature-proof-CI/CD]
    pull_request:

jobs:
    nginx-ci:
        runs-on: ubuntu-latest

        steps:
            # 1Ô∏è‚É£ Clonamos el repositorio
            - name: Checkout repository
              uses: actions/checkout@v4

            # 2Ô∏è‚É£ Validamos la SINTAXIS del nginx.prod.conf
            #    Usamos la imagen oficial de nginx SOLO para validar
            - name: Validate nginx configuration
              run: |
                  docker run --rm \
                    -v ${{ github.workspace }}/nginx/nginx.ci.conf:/etc/nginx/conf.d/default.conf:ro \
                    nginx:stable-alpine \
                    nginx -t

            # 3Ô∏è‚É£ Construimos la imagen Docker de Nginx (producci√≥n)
            #    Esto valida que el Dockerfile.prod es correcto
            - name: Build nginx Docker image
              run: |
                  docker build \
                    -f nginx/Dockerfile.prod \
                    -t wellness-nginx:ci \
                    nginx
